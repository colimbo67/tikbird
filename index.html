<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>colimbo://mini-instagram</title>
  <style>
    body {
      font-family: "JetBrains Mono", "Consolas", monospace;
      background:#0d0d0d;
      color:#00ff9c;
      padding:20px;
      max-width:900px;
      margin:auto;
    }

    h1 {
      text-align:center;
      color:#00ff9c;
      margin-bottom:30px;
      letter-spacing:2px;
    }

    /* LOGIN */
    #loginBox {
      max-width:320px;
      margin:80px auto;
      padding:25px;
      background:#111;
      border:1px solid #00ff9c;
      border-radius:8px;
      box-shadow:0 0 15px #00ff9c33;
    }

    #loginBox input {
      width:100%;
      padding:10px;
      margin:10px 0;
      background:#000;
      color:#00ff9c;
      border:1px solid #00ff9c55;
      border-radius:5px;
    }

    #loginBox button {
      width:100%;
      padding:10px;
      background:#00ff9c;
      color:#000;
      border:none;
      border-radius:5px;
      cursor:pointer;
      font-weight:bold;
    }

    #loginBox button:hover {
      background:#00cc7a;
    }

    /* APP */
    #top {
      display:flex;
      gap:10px;
      justify-content:center;
      margin-bottom:20px;
      flex-wrap:wrap;
    }

    button, input[type="file"] {
      padding:8px 12px;
      border-radius:6px;
      background:#111;
      color:#00ff9c;
      border:1px solid #00ff9c55;
      cursor:pointer;
    }

    button:hover {
      background:#00ff9c;
      color:#000;
    }

    #gallery {
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));
      gap:15px;
      margin-top:20px;
    }

    .card {
      background:#111;
      border:1px solid #00ff9c33;
      border-radius:10px;
      padding:8px;
      box-shadow:0 0 10px #00ff9c22;
    }

    .card img {
      width:100%;
      height:200px;
      object-fit:cover;
      border-radius:8px;
    }
  </style>
</head>
<body>

<h1>colimbo://mini-instagram</h1>

<!-- LOGIN -->
<div id="loginBox" style="display:none;">
  <h2>login</h2>
  <input id="user" placeholder="usuario">
  <input id="pass" type="password" placeholder="contraseña">
  <button onclick="login()">entrar</button>
  <p id="msg" style="color:#ff4d4d;"></p>
</div>

<!-- APP -->
<div id="app" style="display:none;">
  <div id="top">
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="upload()">subir</button>
    <button onclick="logout()">salir</button>
  </div>

  <div id="gallery"></div>
</div>

<script>
/* -------------------------
   CONFIGURACIÓN
-------------------------- */
const USER = "colimbo";
const PASS = "7600";

const username = "TU_USUARIO";  // <-- cámbialo
const repo = "TU_REPO";         // <-- cámbialo
const branch = "main";

/* -------------------------
   LOGIN
-------------------------- */
function checkLogin() {
  if (localStorage.getItem("logged") === "yes") {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("app").style.display = "block";
    loadGallery();
  } else {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("app").style.display = "none";
  }
}

function login() {
  const u = document.getElementById("user").value;
  const p = document.getElementById("pass").value;

  if (u === USER && p === PASS) {
    localStorage.setItem("logged", "yes");
    checkLogin();
  } else {
    document.getElementById("msg").textContent = "acceso denegado";
  }
}

function logout() {
  localStorage.removeItem("logged");
  checkLogin();
}

/* -------------------------
   TOKEN GITHUB
-------------------------- */
let token = localStorage.getItem("github_token");
if (!token) {
  token = prompt("token github:");
  if (token) localStorage.setItem("github_token", token);
}

/* -------------------------
   SUBIR FOTO
-------------------------- */
async function upload() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("selecciona una imagen");

  const reader = new FileReader();
  reader.onloadend = async () => {
    const content = reader.result.split(",")[1];
    const filename = `images/${Date.now()}-${file.name}`;

    await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filename}`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "nueva imagen",
        content: content,
        branch: branch
      })
    });

    loadGallery();
  };

  reader.readAsDataURL(file);
}

/* -------------------------
   GALERÍA
-------------------------- */
async function loadGallery() {
  const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/images`);
  if (!res.ok) return;

  const files = await res.json();
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";

  files
    .filter(f => f.type === "file")
    .sort((a,b) => a.name.localeCompare(b.name))
    .reverse()
    .forEach(f => {
      const card = document.createElement("div");
      card.className = "card";
      const img = document.createElement("img");
      img.src = f.download_url;
      card.appendChild(img);
      gallery.appendChild(card);
    });
}

checkLogin();
</script>

</body>
</html>
