<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Mini Instagram Privado</title>
  <style>
    body { font-family: system-ui, sans-serif; background:#fafafa; padding:20px; max-width:800px; margin:auto; }
    h1 { text-align:center; }

    /* Caja de login */
    #loginBox {
      max-width:300px; margin:80px auto; padding:20px;
      background:white; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1);
    }
    #loginBox input {
      width:100%; padding:10px; margin:10px 0; border-radius:5px; border:1px solid #ccc;
    }
    #loginBox button {
      width:100%; padding:10px; background:#0095f6; color:white; border:none; border-radius:5px;
      cursor:pointer;
    }
    #loginBox button:hover { background:#0077c8; }

    /* Galería */
    #top { display:flex; gap:10px; justify-content:center; margin-bottom:20px; flex-wrap:wrap; }
    button, input[type="file"] {
      padding:8px 12px; border-radius:8px; border:1px solid #ddd; background:white; cursor:pointer;
    }
    button { background:#0095f6; color:white; border:none; }
    button:hover { background:#0077c8; }

    #gallery { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; }
    .card { background:white; border:1px solid #ddd; border-radius:12px; padding:8px; }
    .card img { width:200px; height:200px; object-fit:cover; border-radius:10px; display:block; }
  </style>
</head>
<body>

<h1>Mini Instagram Privado</h1>

<!-- LOGIN -->
<div id="loginBox" style="display:none;">
  <h2>Iniciar sesión</h2>
  <input id="user" placeholder="Usuario">
  <input id="pass" type="password" placeholder="Contraseña">
  <button onclick="login()">Entrar</button>
  <p id="msg" style="color:red;"></p>
</div>

<!-- APP -->
<div id="app" style="display:none;">
  <div id="top">
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="upload()">Subir foto</button>
    <button onclick="logout()">Cerrar sesión</button>
  </div>

  <h2>Galería</h2>
  <div id="gallery"></div>
</div>

<script>
/* -------------------------
   CONFIGURACIÓN
-------------------------- */
const USER = "colimbo";   // usuario inventado
const PASS = "7600";      // contraseña inventada

const username = "TU_USUARIO";  // <-- cámbialo
const repo = "TU_REPO";         // <-- cámbialo
const branch = "main";

/* -------------------------
   SISTEMA DE LOGIN
-------------------------- */
function checkLogin() {
  if (localStorage.getItem("logged") === "yes") {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("app").style.display = "block";
    loadGallery();
  } else {
    document.getElementById("loginBox").style.display = "block";
    document.getElementById("app").style.display = "none";
  }
}

function login() {
  const u = document.getElementById("user").value;
  const p = document.getElementById("pass").value;

  if (u === USER && p === PASS) {
    localStorage.setItem("logged", "yes");
    checkLogin();
  } else {
    document.getElementById("msg").textContent = "Credenciales incorrectas";
  }
}

function logout() {
  localStorage.removeItem("logged");
  checkLogin();
}

/* -------------------------
   TOKEN DE GITHUB
-------------------------- */
let token = localStorage.getItem("github_token");
if (!token) {
  token = prompt("Introduce tu token de GitHub (PAT)");
  if (token) localStorage.setItem("github_token", token);
}

/* -------------------------
   SUBIR FOTO
-------------------------- */
async function upload() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("Selecciona una imagen");

  const reader = new FileReader();
  reader.onloadend = async () => {
    const content = reader.result.split(",")[1];
    const filename = `images/${Date.now()}-${file.name}`;

    await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filename}`, {
      method: "PUT",
      headers: {
        "Authorization": `token ${token}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        message: "Nueva foto",
        content: content,
        branch: branch
      })
    });

    loadGallery();
  };

  reader.readAsDataURL(file);
}

/* -------------------------
   CARGAR GALERÍA
-------------------------- */
async function loadGallery() {
  const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/images`);
  if (!res.ok) return;

  const files = await res.json();
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";

  files
    .filter(f => f.type === "file")
    .sort((a,b) => a.name.localeCompare(b.name))
    .reverse()
    .forEach(f => {
      const card = document.createElement("div");
      card.className = "card";
      const img = document.createElement("img");
      img.src = f.download_url;
      card.appendChild(img);
      gallery.appendChild(card);
    });
}

checkLogin();
</script>

</body>
</html>
